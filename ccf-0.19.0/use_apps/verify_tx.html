
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verifying Transaction &#8212; CCF  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.101715efdecc9b59cb6e1ddfa685c31f.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d8bbf5861d671d414e1a.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Verifying Quote" href="verify_quote.html" />
    <link rel="prev" title="Issuing Commands" href="issue_commands.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/ccf.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-11 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../overview/index.html">Overview</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../build_apps/index.html">Build Apps</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Use Apps</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../operations/index.html">Operations</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../governance/index.html">Governance</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../audit/index.html">Audit</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../contribute/index.html">Contribute</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../glossary.html">Glossary</a>
        </li>
        
        
      </ul>

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Microsoft/CCF" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<script>
    function onVersionChange() {
      window.location.href = document.getElementById("versions").value;
    }

    window.addEventListener("DOMContentLoaded",function(){
        let selectedVersion = "main"
        const thisURL = window.location.toString()
        let indexOfVersion = thisURL.indexOf("ccf-")
        if (indexOfVersion != -1) {
            selectedVersion = thisURL.substring(indexOfVersion, thisURL.indexOf("/", indexOfVersion));
        }
        let sel = document.getElementById("versions");
        if (sel != null) {
            let opts = sel.options;
            for (var opt, j = 0; opt = opts[j]; j++) {
                if (opt.text == selectedVersion) {
                    sel.selectedIndex = j;
                    break;
                }
            }
        }
    }, false);
</script>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
        

        <ul class="nav bd-sidenav">
            
            
            
            
            
            
            
            
            <li class="">
                <a href="issue_commands.html">Issuing Commands</a>
            </li>
            
            
            
            <li class="active">
                <a href="#">Verifying Transaction</a>
            </li>
            
            
            
            <li class="">
                <a href="verify_quote.html">Verifying Quote</a>
            </li>
            
            
            
            <li class="">
                <a href="python_tutorial.html">Python Client Tutorial</a>
            </li>
            
            
            
            <li class="">
                <a href="python_api.html">Python Client API</a>
            </li>
            
            
            
            <li class="">
                <a href="rpc_api.html">RPC API</a>
            </li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </ul>

        
        <h6> Versions </h6>
        <select name="versions" id="versions" class="custom-select custom-select-sm" style="width:50%" onchange="onVersionChange()">
            <option value="../../main/use_apps/verify_tx.html">main </option>
            <option value="../../ccf-0.19.3/use_apps/verify_tx.html">ccf-0.19.3 </option>
            <option value="../../ccf-0.19.2/use_apps/verify_tx.html">ccf-0.19.2 </option>
            <option value="../../ccf-0.19.1/use_apps/verify_tx.html">ccf-0.19.1 </option>
            <option value="verify_tx.html">ccf-0.19.0 </option>
            <option value="../../ccf-0.18.5/use_apps/verify_tx.html">ccf-0.18.5 </option>
            <option value="../../ccf-0.18.4/use_apps/verify_tx.html">ccf-0.18.4 </option>
            <option value="../../ccf-0.18.3/use_apps/verify_tx.html">ccf-0.18.3 </option>
            <option value="../../ccf-0.18.2/use_apps/verify_tx.html">ccf-0.18.2 </option>
            <option value="../../ccf-0.18.1/use_apps/verify_tx.html">ccf-0.18.1 </option>
            <option value="../../ccf-0.18.0/use_apps/verify_tx.html">ccf-0.18.0 </option>
            <option value="../../ccf-0.17.2/use_apps/verify_tx.html">ccf-0.17.2 </option>
            <option value="../../ccf-0.17.1/use_apps/verify_tx.html">ccf-0.17.1 </option>
            <option value="../../ccf-0.17.0/use_apps/verify_tx.html">ccf-0.17.0 </option>
            <option value="../../ccf-0.16.3/use_apps/verify_tx.html">ccf-0.16.3 </option>
        </select>
        
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checking-for-commit">
   Checking for Commit
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transaction-receipts">
   Transaction Receipts
  </a>
 </li>
</ul>

</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/Microsoft/CCF/edit/main/doc/use_apps/verify_tx.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="verifying-transaction">
<h1>Verifying Transaction<a class="headerlink" href="#verifying-transaction" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="checking-for-commit">
<h2>Checking for Commit<a class="headerlink" href="#checking-for-commit" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As part of the <a class="reference internal" href="python_tutorial.html"><span class="doc">CCF Python package</span></a>, the <code class="docutils literal notranslate"><span class="pre">wait_for_commit()</span></code> method can be used to verify that a transaction has successfully been committed.</p>
</div>
<p>Because of the decentralised nature of CCF, a request is committed to the ledger only once a number of nodes have agreed on that request.</p>
<p>To guarantee that their request is successfully committed to the ledger, a user should issue a <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/tx</span></code> request, specifying the version received in the response. This version is constructed from a view and a sequence number.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s2">&quot;https://&lt;ccf-node-address&gt;/app/tx?view=2&amp;seqno=18&quot;</span> --cacert networkcert.pem --key user0_privk.pem --cert user0_cert.pem -i
HTTP/1.1 <span class="m">200</span> OK
content-length: <span class="m">23</span>
content-type: application/json
x-ccf-tx-seqno: <span class="m">42</span>
x-ccf-tx-view: <span class="m">5</span>

<span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;COMMITTED&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>This example queries the status of transaction ID <code class="docutils literal notranslate"><span class="pre">2.18</span></code> (constructed from view <code class="docutils literal notranslate"><span class="pre">2</span></code> and sequence number <code class="docutils literal notranslate"><span class="pre">18</span></code>). The response indicates this was successfully committed. The headers also show that the service has since made progress with other requests (<code class="docutils literal notranslate"><span class="pre">x-ccf-tx-seqno:</span> <span class="pre">42</span></code>) and changed view (<code class="docutils literal notranslate"><span class="pre">x-ccf-tx-view:</span> <span class="pre">5</span></code>).</p>
<p>The possible statuses returned by <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/tx</span></code> are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> - this node has not received a transaction with the given ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PENDING</span></code> - this node has received a transaction with the given ID, but does not yet know if the transaction has been committed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMMITTED</span></code> - this node knows that this transaction is committed, it is an irrevocable and durable part of the serviceâs transaction history</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INVALID</span></code> - this node knows that the given transaction cannot be committed. This occurs when the view changes, and some pending transactions may be lost and must be resubmitted, but also applies to IDs which are known to be impossible given the current committed IDs</p></li>
</ul>
<p>On a given node, the possible transitions between states are described in the following diagram:</p>
<script>mermaid.initialize({startOnLoad:true});</script><div class="mermaid">
            stateDiagram
    UNKNOWN --&gt; PENDING
    PENDING --&gt; UNKNOWN
    PENDING --&gt; COMMITTED
    PENDING --&gt; INVALID
        </div><p>It is possible that intermediate states are not visible (e.g. a transition from <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> to <code class="docutils literal notranslate"><span class="pre">COMMITTED</span></code> may never publically show a <code class="docutils literal notranslate"><span class="pre">PENDING</span></code> result). Nodes may disagree on the current state due to communication delays, but will never disagree on transitions (in other words, they may believe a <code class="docutils literal notranslate"><span class="pre">COMMITTED</span></code> transaction is still <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> or <code class="docutils literal notranslate"><span class="pre">PENDING</span></code>, but will never report it as <code class="docutils literal notranslate"><span class="pre">INVALID</span></code>). A transition from <code class="docutils literal notranslate"><span class="pre">PENDING</span></code> to <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> can only occur immediately after an election, while the node is confirming where the new view starts, and will usually resolve to <code class="docutils literal notranslate"><span class="pre">COMMITTED</span></code> or <code class="docutils literal notranslate"><span class="pre">PENDING</span></code> quickly afterwards.</p>
<p>Note that transaction IDs are uniquely assigned by the service - once a request has been assigned an ID, this ID will never be associated with a different write transaction. In normal operation, the next requests will be given versions 2.19, then 2.20, and so on, and after a short delay <code class="docutils literal notranslate"><span class="pre">2.18</span></code> will be committed. If requests are submitted in parallel, they will be applied in a consistent order indicated by their assigned versions.</p>
<p>If the network is unable to reach consensus, it will trigger a leadership election which increments the view. In this case the userâs next request may be given a version <code class="docutils literal notranslate"><span class="pre">3.16</span></code>, followed by <code class="docutils literal notranslate"><span class="pre">3.17</span></code>, then <code class="docutils literal notranslate"><span class="pre">3.18</span></code>. The sequence number is reused, but in a different view; the service knows that <code class="docutils literal notranslate"><span class="pre">2.18</span></code> can never be assigned, so it can report this as an invalid ID. Read-only transactions are an exception - they do not get a unique transaction ID but instead return the ID of the last write transaction whose state they may have read.</p>
</div>
<div class="section" id="transaction-receipts">
<h2>Transaction Receipts<a class="headerlink" href="#transaction-receipts" title="Permalink to this headline">Â¶</a></h2>
<p>Once a transaction has been committed, it is possible to get a cryptographic receipt over the entry produced in the ledger. That receipt can be verified offline.</p>
<p>To obtain a receipt, a user needs to call a <a class="reference internal" href="rpc_api.html#get--receipt" title="GET /receipt"><code class="xref http http-get docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/receipt</span></code></a> for a particular transaction ID. Because fetching the information necessary to produce a receipt likely involves a round trip to the ledger, the endpoint is implemented as a historical query.
This means that the request may return <code class="docutils literal notranslate"><span class="pre">202</span> <span class="pre">Accepted</span></code> at first, with a suggested <code class="docutils literal notranslate"><span class="pre">Retry-After</span></code> header. A subsequent call will return the actual receipt, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -X GET <span class="s2">&quot;https://&lt;ccf-node-address&gt;/app/receipt?transaction_id=2.23&quot;</span> --cacert networkcert.pem --key user0_privk.pem --cert user0_cert.pem

<span class="o">{</span><span class="s1">&#39;leaf&#39;</span>: <span class="s1">&#39;fdc977c49d3a8bdf986176984e9432a09b5f6fe0c04e0b1c2dd177c03fdca9ec&#39;</span>,
 <span class="s1">&#39;node_id&#39;</span>: <span class="s1">&#39;682c161e1bc0aec694cac58a6ea456e1caa6c9c56d8dd873da9455c341947065&#39;</span>,
 <span class="s1">&#39;proof&#39;</span>: <span class="o">[{</span><span class="s1">&#39;left&#39;</span>: <span class="s1">&#39;f847e5efe3965b0dacb5c15c666602807a11fdecd465d0976779eed27121ffa3&#39;</span><span class="o">}</span>,
           <span class="o">{</span><span class="s1">&#39;left&#39;</span>: <span class="s1">&#39;a56ce9efb73957f561f12d60513281fd2aaf16440234e2fd56e7d3d2ff4be8b0&#39;</span><span class="o">}</span>,
           <span class="o">{</span><span class="s1">&#39;left&#39;</span>: <span class="s1">&#39;d91c982f525302244b13b6add92cd0925e1e0fb621ff2a7bb408ecc51be8528e&#39;</span><span class="o">}</span>,
           <span class="o">{</span><span class="s1">&#39;left&#39;</span>: <span class="s1">&#39;6d87faceda763ce65914f95dfcc04b37ea3f26bc552764752a0f2720039f76be&#39;</span><span class="o">}</span>,
           <span class="o">{</span><span class="s1">&#39;left&#39;</span>: <span class="s1">&#39;e0cc83ea2fae6c535fc44605fb25ba9fdfb319e0e577b3541760f9a3565c549b&#39;</span><span class="o">}</span>,
           <span class="o">{</span><span class="s1">&#39;left&#39;</span>: <span class="s1">&#39;f0e95ed85f5f6c0197aed4f6685b93dc56edd823a2532bd717558a5ab77267cb&#39;</span><span class="o">}]</span>,
 <span class="s1">&#39;root&#39;</span>: <span class="s1">&#39;06fef62c80b6471c7005c1b114166fd1b0e077845f5ad544ad4eea4fb1d31f78&#39;</span>,
 <span class="s1">&#39;signature&#39;</span>: <span class="s1">&#39;MGQCMACklXqd0ge+gBS8WzewrwtwzRzSKy+bfrLZVx0YHmQvtsqs7dExYESsqrUrB8ZcKwIwS3NPKaGq0w2QlPlCqUC3vQoQvhcZgPHPu2GkFYa7JEOdSKLknNPHaCRv80zx2RGF&#39;</span><span class="o">}</span>
</pre></div>
</div>
<p>Verifying a receipt is a two-phase process:</p>
<blockquote>
<div><ul class="simple">
<li><p>Combine <code class="docutils literal notranslate"><span class="pre">leaf</span></code> with the successive elements in <code class="docutils literal notranslate"><span class="pre">proof</span></code> to reproduce the value of <code class="docutils literal notranslate"><span class="pre">root</span></code>. See <a class="reference internal" href="../audit/python_library.html#ccf.receipt.root" title="ccf.receipt.root"><code class="xref py py-func docutils literal notranslate"><span class="pre">ccf.receipt.root()</span></code></a> for a reference implementation.</p></li>
<li><p>Verify <code class="docutils literal notranslate"><span class="pre">signature</span></code> over the <code class="docutils literal notranslate"><span class="pre">root</span></code> using the certificate of the node identified by <code class="docutils literal notranslate"><span class="pre">node_id</span></code>. See <a class="reference internal" href="../audit/python_library.html#ccf.receipt.verify" title="ccf.receipt.verify"><code class="xref py py-func docutils literal notranslate"><span class="pre">ccf.receipt.verify()</span></code></a> for a reference implementation.</p></li>
</ul>
</div></blockquote>
<p>When a node certificate is first obtained, it is necessary to check it has been endorsed by the network identity.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="issue_commands.html" title="previous page">Issuing Commands</a>
    <a class='right-next' id="next-link" href="verify_quote.html" title="next page">Verifying Quote</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.d8bbf5861d671d414e1a.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2018, Microsoft Research.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>